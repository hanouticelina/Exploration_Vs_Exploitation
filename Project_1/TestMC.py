#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import sys

import tic_tac_toe as ttt
import benchmark as bm

class ContinueMainLoop(Exception):
    pass

if __name__=="__main__":
    while(True):
        try:
            b1 =True
            while(b1):
                val=input("\nChoisissez une action à effectuer parmis les suivantes :\nTapez 1 pour jouer une partie\nTapez 2 pour simuler plusieurs partie entre deux Joueurs et générer les courbes de leurs esperances de gain\nTapez 0 pour quitter le programme\n")
                try:
                    ch1=int(val)
                except ValueError:
                    print("Veuillez taper le numéro d'une des actions proposées")
                    continue
                if(ch1<0)or(ch1>2):
                    print("Veuillez taper une valeur entre 0 et 2");
                    continue
                b1=False
            b1=True
            while(b1):
                if(ch1 == 0):
                    sys.exit()
                if(ch1 == 1):
                    b1=False
                    b2=True
                    while(b2):
                        val=input("\nChoisissez une action à effectuer parmis les suivantes :\nTapez 1 pour simuler une partie entre 2 joueur Random\nTapez 2 simuler une partie entre un joueur Random et un Joueur Monte Carlo\nTapez 3 Pour simuler une partie entre 2 joueurs Monte Carlo\nTapez 4 pour revenir à la premiére étape\n")
                        try:
                            ch2=int(val)
                        except ValueError:
                            print("Veuillez taper le numéro d'une des actions proposées")
                            continue
                        if(ch2<0)or(ch2>4):
                            print("Veuillez taper une valeur entre 0 et 4");
                            continue
                        if(ch2 == 0):
                            sys.exit()
                        if(ch2 == 1):
                            bm.play(ttt.RandomPlayer,ttt.RandomPlayer)
                            continue
                        if(ch2 == 2):
                            n = input("\nChoisissez le nombre de parties à échantillonner pour le joueur Monte Carlo\n")
                            try:
                                N=int(n)
                            except ValueError:
                                print("Veuillez taper le numéro d'une des actions proposées")
                                continue
                            bm.play(ttt.MonteCarloPlayer,ttt.RandomPlayer, N1 = N)
                            continue
                        if(ch2 == 3):
                            n = input("\nChoisissez le nombre de parties à échantillonner pour le premier joueur Monte Carlo\n")
                            n2 = input("\nChoisissez le nombre de parties à échantillonner pour le deuxième joueur Monte Carlo\n")
                            try:
                                N=int(n)
                                Nbis = int(n2)
                            except ValueError:
                                print("Veuillez taper le numéro d'une des actions proposées")
                                continue
                            bm.play(ttt.MonteCarloPlayer,ttt.MonteCarloPlayer, N1 = N,N2 = Nbis)
                            continue
                        if(ch2 == 4):
                            b2=False
                            raise ContinueMainLoop()
                if(ch1 == 2):
                    val=input("Tapez 1 pour simuler plusieurs parties entre 2 joueurs Random\nTapez 2 pour simuler plusieurs parties entre un joueur Random et un joueur Monte Carlo\nTapez 3 pour simuler plusieurs parties entre 2 joueurs Monte Carlo\nTapez 4 pour revenir à la premiére étape\n")
                    try:
                        ch2=int(val)
                    except ValueError:
                        print("Veuillez taper le numéro d'une des actions proposées")
                        continue
                    if(ch2<0)or(ch2>4):
                        print("Veuillez taper une valeur entre 0 et 2");
                        continue

                    if(ch2==0):
                        sys.exit()
                    b2=True
                    while(b2):
                        if(ch2==1):
                            nb = input("\nChoisissez le nombre de parties\n")
                            try:
                                nb_iter=int(nb)
                            except ValueError:
                                print("Veuillez taper le numéro d'une des actions proposées")
                                continue
                            bm.simulation(nb_iter, ttt.RandomPlayer, ttt.RandomPlayer,bm.labels)
                            b2=False
                            raise ContinueMainLoop()
                        if(ch2==2):
                            nb = input("\nChoisissez le nombre de parties\n")
                            try:
                                nb_iter=int(nb)
                            except ValueError:
                                print("Veuillez taper le numéro d'une des actions proposées")
                                continue
                            n = input("\nChoisissez le nombre de parties à échantillonner pour le joueur Monte Carlo\n")
                            try:
                                N=int(n)
                            except ValueError:
                                print("Veuillez taper le numéro d'une des actions proposées")
                                continue
                            bm.simulation(nb_iter, ttt.MonteCarloPlayer, ttt.RandomPlayer,bm.labels,N1 = N)
                            b2=False
                            raise ContinueMainLoop()
                        if(ch2==3):
                            nb = input("\nChoisissez le nombre de parties\n")
                            try:
                                nb_iter=int(nb)
                            except ValueError:
                                print("Veuillez taper le numéro d'une des actions proposées")
                                continue
                            n = input("\nChoisissez le nombre de parties à échantillonner pour le joueur Monte Carlo\n")
                            try:
                                N=int(n)
                            except ValueError:
                                print("Veuillez taper le numéro d'une des actions proposées")
                                continue
                            n2 = input("\nChoisissez le nombre de parties à échantillonner pour le deuxième joueur Monte Carlo\n")
                            try:
                                Nbis=int(n)
                            except ValueError:
                                print("Veuillez taper le numéro d'une des actions proposées")
                                continue
                            bm.simulation(nb_iter, ttt.MonteCarloPlayer, ttt.MonteCarloPlayer,bm.labels,N1 = N, N2 = Nbis)
                            b2=False
                            raise ContinueMainLoop()
                        if(ch2==4):
                            b2=False
                            raise ContinueMainLoop()
        except ContinueMainLoop:
            continue
